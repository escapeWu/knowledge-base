---
{"dg-publish":true,"permalink":"/frontend/utils/utils-indexed-db-crud/","created":"2024-01-19T16:07:11.493+08:00","updated":"2024-01-18T16:39:45.000+08:00"}
---


#browser #web-storage #utils #frontend 
> generated by GPT-4
```ts
interface DBConfig {
  dbName: string
  storeName: string
}

export class IndexedDBWrapper {
  private dbName: string
  private storeName: string
  private db: IDBDatabase | null

  constructor({ dbName, storeName }: DBConfig) {
    this.dbName = dbName
    this.storeName = storeName
    this.db = null
  }

  private open(): Promise<IDBDatabase> {
    return new Promise((resolve, reject) => {
      if (this.db) {
        resolve(this.db)
      }
      else {
        const request = indexedDB.open(this.dbName, 1)

        request.onupgradeneeded = (event: IDBVersionChangeEvent) => {
          const db = (event.target as IDBOpenDBRequest).result
          db.createObjectStore(this.storeName, { keyPath: 'key' })
        }

        request.onsuccess = (event: Event) => {
          this.db = (event.target as IDBOpenDBRequest).result
          resolve(this.db)
        }

        request.onerror = (event: Event) => {
          reject((event.target as IDBOpenDBRequest).error)
        }
      }
    })
  }

  public insert(key: string, value: string): Promise<void> {
    return this.open().then((db) => {
      return new Promise<void>((resolve, reject) => {
        const transaction = db.transaction([this.storeName], 'readwrite')
        const store = transaction.objectStore(this.storeName)
        const request = store.put({ key, value })

        request.onsuccess = () => resolve()
        request.onerror = (event: Event) => reject((event.target as IDBRequest).error)
      })
    })
  }

  public delete(key: string): Promise<void> {
    return this.open().then((db) => {
      return new Promise<void>((resolve, reject) => {
        const transaction = db.transaction([this.storeName], 'readwrite')
        const store = transaction.objectStore(this.storeName)
        const request = store.delete(key)

        request.onsuccess = () => resolve()
        request.onerror = (event: Event) => reject((event.target as IDBRequest).error)
      })
    })
  }

  public query(key: string): Promise<string | null> {
    return this.open().then((db) => {
      return new Promise<string | null>((resolve, reject) => {
        const transaction = db.transaction([this.storeName], 'readonly')
        const store = transaction.objectStore(this.storeName)
        const request = store.get(key)

        request.onsuccess = (event: Event) => {
          const result = (event.target as IDBRequest).result
          resolve(result ? result.value : null)
        }
        request.onerror = (event: Event) => reject((event.target as IDBRequest).error)
      })
    })
  }
}
```

// 使用示例
```ts

const dbWrapper = new IndexedDBWrapper({ dbName: 'myDatabase', storeName: 'myObjectStore' });

// 插入数据
dbWrapper.insert('E-DAM', 'anystring').then(() => {
    console.log('Data inserted');
}).catch((error: DOMException) => {
    console.error('Insert error:', error);
});

// 查询数据
dbWrapper.query('E-DAM').then((value) => {
    console.log('Data queried:', value);
}).catch((error: DOMException) => {
    console.error('Query error:', error);
});

// 删除数据
dbWrapper.delete('E-DAM').then(() => {
    console.log('Data deleted');
}).catch((error: DOMException) => {
    console.error('Delete error:', error);
});
```